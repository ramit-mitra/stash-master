(window.webpackJsonp=window.webpackJsonp||[]).push([[270],{1018:function(t,e,n){"use strict";var o=n(0),i=n(15),r=n(13),a=n(237);function c(t){var e=t.link,n=void 0===e||e,i=t.organization;return t.shouldBeDisplayed&&i?o.createElement("span",null,n?o.createElement(a.a,{className:t.linkClassName,organization:i},i.name):i.name,o.createElement("span",{className:"slash-separator"})):null}e.a=Object(i.connect)(function(t,e){return{organization:Object(r.getOrganizationByKey)(t,e.organizationKey),shouldBeDisplayed:Object(r.areThereCustomOrganizations)(t)}})(c)},1071:function(t,e,n){var o=n(343),i=n(221),r=n(219),a=n(339),c=n(346),s=r(function(t,e){var n=c(e);return a(n)&&(n=void 0),a(t)?o(t,i(e,1,a,!0),void 0,n):[]});t.exports=s},1072:function(t,e,n){var o=n(340)(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]});t.exports=o},1386:function(t,e,n){var o=n(255);t.exports=function(t,e){return e="function"==typeof e?e:void 0,t&&t.length?o(t,void 0,e):[]}},1564:function(t,e,n){"use strict";n.r(e);var o,i=n(15),r=n(1386),a=n.n(r),c=n(67),s=n.n(c),p=n(33),l=n.n(p),u=n(1072),f=n.n(u),d=n(901),h=n.n(d),m=n(0),y=n(212),j=n.n(y),v=n(4),b=n(90),g=n(1),N=(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return N(e,t),e.prototype.isEnabled=function(t,e){return!!this.props.notifications.find(function(n){return n.type===t&&n.channel===e})},e.prototype.handleCheck=function(t,e,n){n?this.props.onAdd({type:t,channel:e}):this.props.onRemove({type:t,channel:e})},e.prototype.getDispatcherLabel=function(t){var e=["notification.dispatcher",t],n=e.concat(["project"]);return this.props.project&&g.i.apply(void 0,n)?g.l.apply(void 0,n):g.l.apply(void 0,e)},e.prototype.render=function(){var t=this,e=this.props,n=e.channels,o=e.checkboxId,i=e.types;return m.createElement("tbody",null,i.map(function(e){return m.createElement("tr",{key:e},m.createElement("td",null,t.getDispatcherLabel(e)),n.map(function(n){return m.createElement("td",{className:"text-center",key:n},m.createElement(b.a,{checked:t.isEnabled(e,n),id:o(e,n),onCheck:function(o){return t.handleCheck(e,n,o)}}))}))}))},e}(m.PureComponent);function O(t){return m.createElement("section",{className:"boxed-group"},m.createElement("h2",null,Object(g.l)("my_profile.overall_notifications.title")),m.createElement("div",{className:"boxed-group-inner"},m.createElement("table",{className:"form"},m.createElement("thead",null,m.createElement("tr",null,m.createElement("th",null),t.channels.map(function(t){return m.createElement("th",{className:"text-center",key:t},m.createElement("h4",null,Object(g.l)("notification.channel",t)))}))),m.createElement(E,{channels:t.channels,checkboxId:_,notifications:t.notifications,onAdd:t.addNotification,onRemove:t.removeNotification,types:t.types}))))}function _(t,e){return"global-notification-"+t+"-"+e}var k=n(1071),P=n.n(k),z=n(2),x=n(1018),w=n(41),T=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.getCheckboxId=function(t,n){return"project-notification-"+e.props.project.key+"-"+t+"-"+n},e.handleAddNotification=function(t){var n=t.channel,o=t.type;e.props.addNotification({channel:n,type:o,project:e.props.project.key,projectName:e.props.project.name,organization:e.props.project.organization})},e.handleRemoveNotification=function(t){var n=t.channel,o=t.type;e.props.removeNotification({channel:n,type:o,project:e.props.project.key})},e}return T(e,t),e.prototype.render=function(){var t=this.props,e=t.project,n=t.channels;return m.createElement("table",{className:"form big-spacer-bottom",key:e.key},m.createElement("thead",null,m.createElement("tr",null,m.createElement("th",null,m.createElement("span",{className:"text-normal"},m.createElement(x.a,{organizationKey:e.organization})),m.createElement("h4",{className:"display-inline-block"},m.createElement(z.Link,{to:Object(w.s)(e.key)},e.name))),n.map(function(t){return m.createElement("th",{className:"text-center",key:t},m.createElement("h4",null,Object(g.l)("notification.channel",t)))}))),m.createElement(E,{channels:this.props.channels,checkboxId:this.getCheckboxId,notifications:this.props.notifications,onAdd:this.handleAddNotification,onRemove:this.handleRemoveNotification,project:!0,types:this.props.types}))},e}(m.PureComponent),C=n(52),A=n(213),R=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),B=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={addedProjects:[]},e.loadOptions=function(t){return t.length<2?Promise.resolve({options:[]}):Object(C.s)(t).then(function(t){var e=t.results.find(function(t){return"TRK"===t.q});return e?e.items:[]}).then(function(t){return t.filter(function(t){return!e.props.projects.find(function(e){return e.key===t.key})&&!e.state.addedProjects.find(function(e){return e.key===t.key})}).map(function(t){return{value:t.key,label:t.name,organization:t.organization}})}).then(function(t){return{options:t}})},e.handleAddProject=function(t){var n={key:t.value,name:t.label,organization:t.organization};e.setState(function(t){return{addedProjects:t.addedProjects.concat([n])}})},e.renderOption=function(t){return m.createElement("span",null,m.createElement(x.a,{link:!1,organizationKey:t.organization}),m.createElement("strong",null,t.label))},e}return R(e,t),e.prototype.componentWillReceiveProps=function(t){this.setState(function(e){return{addedProjects:P()(e.addedProjects,Object.keys(t.projects),function(t,e){return t.key!==e})}})},e.prototype.render=function(){var t=this,e=this.props.projects.concat(this.state.addedProjects);return m.createElement("section",{className:"boxed-group"},m.createElement("h2",null,Object(g.l)("my_profile.per_project_notifications.title")),m.createElement("div",{className:"boxed-group-inner"},0===e.length&&m.createElement("div",{className:"note"},Object(g.l)("my_account.no_project_notifications")),e.map(function(e){return m.createElement(S,{addNotification:t.props.addNotification,channels:t.props.channels,key:e.key,notifications:t.props.notificationsByProject[e.key]||[],project:e,removeNotification:t.props.removeNotification,types:t.props.types})}),m.createElement("div",{className:"spacer-top panel bg-muted"},m.createElement("span",{className:"text-middle spacer-right"},Object(g.l)("my_account.set_notifications_for"),":"),m.createElement(A.a,{autoload:!1,cache:!1,className:"input-super-large",loadOptions:this.loadOptions,name:"new_project",onChange:this.handleAddProject,optionRenderer:this.renderOption,placeholder:Object(g.l)("my_account.search_project")}))))},e}(m.PureComponent),D=n(10),I=n(5);var K=n(42),F=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),J=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mounted=!1,e.state={channels:[],globalTypes:[],loading:!0,notifications:[],perProjectTypes:[]},e.fetchNotifications=function(){Object(I.getJSON)("/api/notifications/list").catch(D.a).then(function(t){if(e.mounted){if(e.context.organizationsEnabled){var n=l()(t.notifications.filter(function(t){return t.organization}).map(function(t){return t.organization}));e.props.fetchOrganizations(n)}e.setState({channels:t.channels,globalTypes:t.globalTypes,loading:!1,notifications:t.notifications,perProjectTypes:t.perProjectTypes})}},function(){e.mounted&&e.setState({loading:!1})})},e.addNotificationToState=function(t){e.setState(function(e){return{notifications:a()(e.notifications.concat([t]),L)}})},e.removeNotificationFromState=function(t){e.setState(function(e){return{notifications:e.notifications.filter(function(e){return!L(e,t)})}})},e.addNotification=function(t){e.addNotificationToState(t),function(t){return Object(I.post)("/api/notifications/add",t).catch(D.a)}({channel:t.channel,project:t.project,type:t.type}).catch(function(){e.removeNotificationFromState(t)})},e.removeNotification=function(t){e.removeNotificationFromState(t),function(t){return Object(I.post)("/api/notifications/remove",t).catch(D.a)}({channel:t.channel,project:t.project,type:t.type}).catch(function(){e.addNotificationToState(t)})},e}return F(e,t),e.prototype.componentDidMount=function(){this.mounted=!0,this.fetchNotifications()},e.prototype.componentWillUnmount=function(){this.mounted=!1},e.prototype.render=function(){var t=f()(this.state.notifications,function(t){return!t.project}),e=t[0],n=t[1],o=s()(n.map(function(t){return{key:t.project,name:t.projectName,organization:t.organization}}),function(t){return t.key}),i=h()(n,function(t){return t.project});return m.createElement("div",{className:"account-body account-container"},m.createElement(j.a,{title:Object(g.l)("my_account.notifications")}),m.createElement("p",{className:"alert alert-info"},Object(g.l)("notification.dispatcher.information")),m.createElement(K.a,{loading:this.state.loading},this.state.notifications&&m.createElement(m.Fragment,null,m.createElement(O,{addNotification:this.addNotification,channels:this.state.channels,notifications:e,removeNotification:this.removeNotification,types:this.state.globalTypes}),m.createElement(B,{addNotification:this.addNotification,channels:this.state.channels,notificationsByProject:i,projects:o,removeNotification:this.removeNotification,types:this.state.perProjectTypes}))))},e.contextTypes={organizationsEnabled:v.bool},e}(m.PureComponent);function L(t,e){return t.channel===e.channel&&t.type===e.type&&t.project===e.project}var W={fetchOrganizations:n(116).f};e.default=Object(i.connect)(null,W)(J)},901:function(t,e,n){var o=n(162),i=n(340),r=Object.prototype.hasOwnProperty,a=i(function(t,e,n){r.call(t,n)?t[n].push(e):o(t,n,[e])});t.exports=a}}]);
//# sourceMappingURL=270.8fc233e8.chunk.js.map